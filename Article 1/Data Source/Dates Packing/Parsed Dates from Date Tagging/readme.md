# ğŸ—“ï¸ Date Extraction Pipeline

**Author:** Samuel Jiang  
**Last Updated:** November 2025  

---

## Overview

This repository contains the **date extraction pipeline** for multilingual Wikipedia-derived text datasets.  
It processes the outputs of **date-tagging system**, which adds `<date>` tags around temporal expressions, and extracts the actual **numerical year values** (e.g., 1854, 400 BC, 2012) into clean CSV files.

---

## ğŸ§© Data Source

The input data are located in:

```
/local/scratch/group/guldigroup/climate_change/wiki_history_rosie/date_tagging_pipeline/
â””â”€â”€ tagged_output_2025-09-20_deduped/
    â”œâ”€â”€ historical_objects_tagged/
    â”œâ”€â”€ history_of_ideologies_tagged/
    â””â”€â”€ history_of_sports_tagged/
```

Each folder contains one or more `.csv` files generated by the **date tagging** step.  
Every file has at least two columns:

| Column | Description |
|:-------|:-------------|
| `filename` | The name of the text source (e.g., article or document) |
| `date_tagged` | The text with inline `<date>` tags around detected temporal phrases |

---

## âš™ï¸ What the Script Does

The main script, `extract_years_pipeline.py`, takes these tagged CSVs as input and produces simplified CSVs that record all parsed year values for each file.

**In one sentence:**  
> The code reads every tagged file, extracts numeric years from `<date>` tags, filters noise, and outputs one summary CSV per dataset.

**Key operations include:**
- Detects and parses `<date> ... </date>` tags.
- Recognizes **BC/BCE**, **AD/CE**, **ISO dates**, and **month-day-year** patterns.
- Ignores **centuries**, **decades**, **dynasty names**, and ambiguous **year ranges** (e.g., 1200â€“1300).
- Handles malformed inputs (e.g., â€œ4000,000â€ or multi-thousand numbers).
- Outputs one CSV per subfolder to the userâ€™s **Desktop**:
  ```
  parsed_years_historical_objects_tagged.csv
  parsed_years_history_of_ideologies_tagged.csv
  parsed_years_history_of_sports_tagged.csv
  ```

Each output CSV contains:

| Column | Description |
|:--------|:-------------|
| `filename` | Original text filename |
| `parsed_years` | Comma-separated list of extracted year values |

---

## ğŸ“ Output Example

```
filename,parsed_years
ancient_art.txt,-500
modern_society.txt,1968,1990,2001
sports_in_rome.txt,-300,64
```

---

## ğŸ§  Code Structure

```
extract_years_pipeline.py
â”œâ”€â”€ extract_years()       â†’ parses a single <date> tag
â”œâ”€â”€ extract_dates()       â†’ extracts all <date> tags in a cell
â”œâ”€â”€ process_subfolder()   â†’ processes all CSVs in a given dataset folder
â”œâ”€â”€ main()                â†’ iterates through all subfolders
â””â”€â”€ _test_extract()       â†’ unit test for sample inputs
```

Each function contributes to a modular, transparent, and easily testable workflow.

---

## ğŸ§ª Quick Test

To verify functionality, the script includes a self-test:

```bash
python3 extract_years_pipeline.py
```

Youâ€™ll see example inputs and parsed outputs, e.g.:

```
Input: 2012-02-29 â†’ Parsed: [2012]
Input: 4000-2000 BCE â†’ Parsed: []
Input: 4,000 BC â†’ Parsed: [-4000]
```

## âœ… Summary

- **Input:** Rosieâ€™s date-tagged CSVs (`*_tagged.csv`)  
- **Output:** Clean year lists (`parsed_years_*.csv`)  
- **Goal:** Prepare structured year data for temporal visualization and statistical modeling  
